<autom-label *ngIf="label" [label]="label" class="gc-title"></autom-label>

<section class="gc gc--sidebar gc--dense" role="tree">
  <ng-container *ngFor="let task of tasks(); let i = index">
    <article
      class="gc-group"
      role="treeitem"
      [attr.aria-expanded]="task.expanded"
    >
      <!-- HEADER: group master -->
      <div class="gc-h">
        <mat-checkbox
          class="gc-h__cb"
          [checked]="task.completed"
          [indeterminate]="partiallyComplete()[i]"
          (click)="$event.stopPropagation()"
          (change)="update($event.checked, i)"
        >
          <span class="gc-h__label" [matTooltip]="task.name">{{
            task.name
          }}</span>
        </mat-checkbox>

        <div class="gc-h__tools">
          <span class="gc-badge" *ngIf="task.subtasks?.length">
            {{ countSelected(task) }}/{{ countTotal(task) }}
          </span>

          <button
            class="gc-toggle"
            type="button"
            [attr.aria-label]="task.expanded ? 'Sažmi' : 'Proširi'"
            [attr.aria-expanded]="task.expanded"
            (click)="toggleExpand(i)"
          >
            <autom-icon
              class="gc-chev"
              [source]="
                task.expanded ? iconsEnum.CHEVRON_UP : iconsEnum.CHEVRON_DOWN
              "
            ></autom-icon>
          </button>
        </div>
      </div>

      <!-- BODY: children -->
      <div class="gc-b" *ngIf="task.expanded">
        <ul class="gc-list" role="group">
          <li
            *ngFor="let sub of task.subtasks; let j = index"
            class="gc-row"
            role="treeitem"
          >
            <mat-checkbox
              class="gc-row__cb"
              [checked]="sub.completed"
              (click)="$event.stopPropagation()"
              (change)="update($event.checked, i, j)"
            >
              <span class="gc-row__label" [matTooltip]="sub.name">{{
                sub.name
              }}</span>
            </mat-checkbox>
          </li>
        </ul>
      </div>
    </article>
  </ng-container>
</section>
