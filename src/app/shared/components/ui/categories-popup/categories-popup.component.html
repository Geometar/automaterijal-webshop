<autom-popup
  class="categories-selection"
  [height]="sizeEnum.FULL_VH"
  [position]="positionEnum.LEFT"
  [width]="sizeEnum.LARGE"
  [rounded]="true"
  (close)="close.emit()"
>
  <!-- HEADER / HERO (sticky) -->
  <div custom-header class="cp-header">
    <div class="cp-hero">
      <div class="cp-hero__left">
        <h3 class="cp-title">{{ title }}</h3>
        <p class="cp-subtitle">
          Brza navigacija kroz 27 grupa i 150+ podgrupa.
        </p>
      </div>

      <div class="cp-hero__right">
        <!-- Use your autom-input-fields as a controlled search input -->
        <autom-input-fields
          class="cp-search-input"
          [type]="inputTypeEnum.SEARCH"
          [label]="'Pretraži kategorije...'"
          (emitValue)="onSearch($event)"
          (emitSelected)="onSearch($event)"
          (emitValueDebounced)="onSearch($event)"
        ></autom-input-fields>
      </div>

      <!-- Close button -->
      <autom-icon
        class="cp-close"
        [color]="colorEnum.GREY_400"
        [source]="iconsEnum.X"
        (click)="close.emit()"
      ></autom-icon>
    </div>

    <!-- QUICK TAGS -->
    <div class="cp-quick-tags" *ngIf="!loading()">
      <button
        *ngFor="let t of quickTags"
        class="cp-tag"
        type="button"
        (click)="useQuickTag(t.id)"
      >
        {{ t.label }}
      </button>
      <button class="cp-tag ghost" type="button" (click)="reset()">
        Reset
      </button>
    </div>
  </div>

  <!-- BODY: side-nav (groups) + cards (subgroups) -->
  <div custom-body class="cp-body">
    <!-- LEFT: groups with icons & separators -->
    <aside class="cp-groups">
      <ng-container *ngIf="!loading(); else skeletonLeft">
        <div
          *ngFor="let g of filtered(); trackBy: trackGroup"
          class="cp-group-item"
          [class.active]="g.groupId === selectedGroupId()"
          (click)="selectGroup(g)"
        >
          <span class="cp-group-icon" [style.--accent]="accentForGroup(g)">
            <autom-icon [source]="iconForGroup(g)"></autom-icon>
          </span>

          <div class="cp-group-text">
            <div class="cp-group-name">{{ g.name }}</div>
            <div class="cp-group-meta">
              <!-- Optional: if you have counts in future, place them here -->
              <!-- <span class="cp-badge">{{ g.articleSubGroups?.length || 0 }}</span> -->
              <span class="cp-divider"></span>
              <span class="cp-hint">Klikni za podgrupe</span>
            </div>
          </div>

          <span class="cp-arrow"></span>
        </div>
      </ng-container>

      <ng-template #skeletonLeft>
        <div class="skeleton-line" *ngFor="let i of [].constructor(8)"></div>
      </ng-template>
    </aside>

    <!-- RIGHT: animated cards grid for subgroups -->
    <section class="cp-subgroups">
      <ng-container *ngIf="selectedGroup() as sel; else pickPrompt">
        <div class="cp-subgroups-header">
          <div class="cp-subgroups-title">
            {{ sel.name }}
            <span
              class="cp-dot"
              [style.background]="accentForGroup(sel)"
            ></span>
          </div>

          <button class="cp-all-btn" type="button" (click)="pickGroup(sel)">
            Sve iz: {{ sel.name }}
          </button>
        </div>

        <div class="cp-subgrid">
          <button
            *ngFor="
              let s of sel.articleSubGroups;
              let idx = index;
              trackBy: trackSub
            "
            class="cp-card"
            type="button"
            [style.--delay]="idx * 30 + 'ms'"
            (click)="pickSub(s)"
          >
            <div
              class="cp-card__icon"
              [style.borderColor]="accentForGroup(sel)"
            >
              <autom-icon [source]="iconForGroup(sel)"></autom-icon>
            </div>
            <div class="cp-card__name">{{ s.name }}</div>
            <div class="cp-card__cta">Prikaži</div>
          </button>
        </div>
      </ng-container>

      <ng-template #pickPrompt>
        <div class="cp-empty-state">Izaberite grupu sa leve strane</div>
      </ng-template>
    </section>
  </div>
</autom-popup>
