<div class="util__flex--center filter-container">
  <div class="filter-icons">
    <autom-icon
      [source]="iconEnum.THREE_LAYERS"
      [color]="isGridView() ? colorEnum.YELLOW_700 : colorEnum.RICH_BLACK"
      [tooltip]="{ tooltipText: 'Mre≈æni prikaz (Grid View)' }"
      [attr.aria-pressed]="isGridView()"
      role="button"
      tabindex="0"
      (click)="activateGridView()"
      (keyup.enter)="activateGridView()"
      (keyup.space)="activateGridView()"
    ></autom-icon>

    <autom-icon
      [source]="iconEnum.ALIGN_LEFT"
      [color]="isListView() ? colorEnum.YELLOW_700 : colorEnum.RICH_BLACK"
      [tooltip]="{ tooltipText: 'Prikaz kao lista (List View)' }"
      [attr.aria-pressed]="isListView()"
      role="button"
      tabindex="0"
      (click)="activateListView()"
      (keyup.enter)="activateListView()"
      (keyup.space)="activateListView()"
    ></autom-icon>
  </div>

  <autom-input-fields
    class="filter-groups"
    [label]="'Filtriraj grupe'"
    [preIcon]="iconEnum.FILTER"
    [round]="true"
    [type]="inputType.SEARCH"
    (emitSelected)="filterStructuredGroups($event)"
  ></autom-input-fields>
</div>

<div
  class="assembly-groups-container"
  [ngClass]="{
    'grid-view': isGridView(),
    'list-view-wrapper': isListView()
  }"
>
  <ng-container *ngIf="isGridView()">
    <div
      class="assembly-group-card"
      *ngFor="let group of structuredGroups; trackBy: trackByGroup"
      [ngClass]="{
        expanded: isCardExpanded(group.assemblyGroupNodeId!),
        'is-muted': searchTerm && !isMatchedGroup(group.assemblyGroupNodeId!)
      }"
    >
      <div class="card-header">
        <h3 (click)="onGroupSelected(group)">
          <span class="icon">üì¶</span>
          <span [innerHTML]="getHighlightedName(group)"></span>
        </h3>
      </div>
      <div class="card-body">
        <ul
          class="child-list"
          [ngClass]="{
            collapsing: !isCardExpanded(group.assemblyGroupNodeId!)
          }"
        >
          <li
            *ngFor="
              let child of shouldShowAllChildren(group.assemblyGroupNodeId!)
                ? group.childrenNodes
                : group.childrenNodes?.slice(0, 5);
              trackBy: trackByGroup
            "
            class="layer-child-item"
            [ngClass]="{
              'is-grandchild': child.parentNodeId !== group.assemblyGroupNodeId,
              'is-muted': searchTerm && !isMatchedGroup(child.assemblyGroupNodeId)
            }"
            (click)="onGroupSelected(child, $event)"
          >
            <span
              class="tree-icon"
              *ngIf="child.parentNodeId !== group.assemblyGroupNodeId"
              >üõ†Ô∏è</span
            >
            <span [innerHTML]="getHighlightedName(child)"></span>
          </li>
        </ul>
      </div>
      <div class="card-footer" *ngIf="group.childrenNodes!.length > 5">
        <autom-button
          class="show-all-btn"
          [label]="
            isCardExpanded(group.assemblyGroupNodeId!)
              ? 'Prika≈æi manje'
              : 'Prika≈æi sve'
          "
          (click)="toggleShowAll(group.assemblyGroupNodeId!, $event)"
        >
        </autom-button>
      </div>
    </div>
  </ng-container>

  <ul *ngIf="isListView()" class="list-view-container">
    <li
      *ngFor="let group of structuredGroups; trackBy: trackByGroup"
      class="list-item"
      [ngClass]="{
        'is-muted': searchTerm && !isMatchedGroup(group.assemblyGroupNodeId!)
      }"
    >
      <div class="list-header">
        <span
          class="arrow"
          [ngClass]="{ expanded: isListExpanded(group.assemblyGroupNodeId!) }"
          (click)="toggleList(group.assemblyGroupNodeId!); $event.stopPropagation()"
        >
          ‚ñ∂
        </span>
        <span
          class="list-header-value"
          [innerHTML]="getHighlightedName(group)"
          (click)="onGroupSelected(group, $event)"
        ></span>
      </div>
      <ul
        class="nested-list"
        [ngClass]="{ expanded: isListExpanded(group.assemblyGroupNodeId!) }"
        *ngIf="isListExpanded(group.assemblyGroupNodeId!)"
      >
        <li
          *ngFor="let child of group.childrenNodes; trackBy: trackByGroup"
          class="nested-item"
          [ngClass]="{
            'is-grandchild': child.parentNodeId !== group.assemblyGroupNodeId,
            'is-muted': searchTerm && !isMatchedGroup(child.assemblyGroupNodeId)
          }"
          (click)="onGroupSelected(child, $event)"
        >
          <span
            class="tree-icon"
            *ngIf="child.parentNodeId !== group.assemblyGroupNodeId"
            >üõ†Ô∏è</span
          >
          <span [innerHTML]="getHighlightedName(child)"></span>
        </li>
      </ul>
    </li>
  </ul>
</div>
