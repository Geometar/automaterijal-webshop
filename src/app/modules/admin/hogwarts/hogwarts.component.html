<section class="hogwarts-page">
  <div class="nebula nebula-1"></div>
  <div class="nebula nebula-2"></div>
  <div class="nebula nebula-3"></div>

  <div class="hogwarts-card">
    <div class="card-header">
      <div class="crest">
        <autom-icon [source]="icons.STAR"></autom-icon>
      </div>
      <div>
        <p class="eyebrow">Super Admin Sanctum</p>
        <h1>Hogwarts</h1>
        <p class="lede">
          Febi price list spellbook — upload & reload bez restarta.
        </p>
      </div>
    </div>
    <div class="sigil" aria-hidden="true">
      <svg viewBox="0 0 64 64">
        <path d="M32 4 12 14v18c0 12 9 22 20 28 11-6 20-16 20-28V14Z" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linejoin="round"/>
        <path d="M22 30l5 6 15-14" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M32 18v8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </div>

    <div class="spell-row">
      <label class="file-drop" [class.has-file]="uploadFile" [class.disabled]="loading">
        <span class="label-title">Odaberi novi price list (.xlsx)</span>
        <span class="label-sub">Najnoviji grimoire sa Febi cenama</span>
        <div class="file-chip" *ngIf="uploadFile; else filePlaceholder">
          <autom-icon [source]="icons.FILE"></autom-icon>
          <span>{{ uploadFile.name }}</span>
        </div>
        <ng-template #filePlaceholder>
          <div class="file-chip ghost">
            <autom-icon [source]="icons.UPLOAD_CLOUD"></autom-icon>
            <span>Izaberi fajl</span>
          </div>
        </ng-template>
        <input
          #fileInput
          id="hogwarts-file-input"
          type="file"
          accept=".xlsx"
          [attr.disabled]="loading ? true : null"
          (change)="onFileSelected($event)"
        />
      </label>

      <div class="cta-row">
        <button class="hogwarts-btn primary" [class.is-loading]="loading" (click)="castUpload()" [disabled]="loading">
          <span class="spark"></span>
          <autom-icon [source]="icons.CAST"></autom-icon>
          <span>{{ loading ? 'Casting...' : 'Cast upload' }}</span>
          <span class="btn-spinner" *ngIf="loading"></span>
        </button>
        <button class="hogwarts-btn ghost" [class.is-loading]="loading" (click)="recastFromDisk()" [disabled]="loading">
          <autom-icon [source]="icons.REFRESH_CW"></autom-icon>
          <span>{{ loading ? 'Recasting...' : 'Recast from disk' }}</span>
          <span class="btn-spinner" *ngIf="loading"></span>
        </button>
      </div>
    </div>

      <div class="status" *ngIf="statusMessage">
        <div class="status-badge" [ngClass]="statusType">
          <autom-icon [source]="statusType === 'success' ? icons.CHECK : icons.ALERT_TRIANGLE"></autom-icon>
          <span>{{ statusMessage }}</span>
        </div>
      <div class="meta">
        <span *ngIf="lastCount !== null">Tomes indexed: {{ lastCount }}</span>
        <span *ngIf="lastPath">Path: {{ lastPath }}</span>
        <span *ngIf="lastModified">Last modified: {{ lastModified | date:'dd.MM.yyyy HH:mm' }}</span>
        <span *ngIf="lastSizeBytes !== null">Size: {{ lastSizeBytes / 1024 | number:'1.0-1' }} KB</span>
      </div>
    </div>

    <div class="casting" *ngIf="loading">
      <div class="orb"></div>
      <span>Bacanje čini...</span>
    </div>
  </div>
</section>
