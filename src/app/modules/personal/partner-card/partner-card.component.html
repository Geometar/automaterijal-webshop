<section class="header-margin--top partner-card">
  <autom-header
    [headerData]="headerData"
    [headingLevel]="headingLevelEnum.H2"
  ></autom-header>

  <div *ngIf="isAdmin" class="partner-card__admin">
    <div class="partner-card__admin-card">
      <span class="partner-card__admin-tag">Admin alat</span>
      <h3 class="partner-card__admin-title">Pregled kartica partnera</h3>
      <p class="partner-card__admin-subtitle">
        Pronađite partnera i preuzmite njegove dokumente bez napuštanja ove
        stranice.
      </p>
      <div class="partner-card__admin-controls">
        <typeahead
          [data]="admin.items"
          [label]="'Pronađi partnera'"
          [selectedItem]="admin.selection"
          (emit)="onPartnerSelected($event)"
          (search)="onPartnerSearch($event)"
        ></typeahead>
        <div *ngIf="admin.loading" class="partner-card__admin-status">
          Pretraga...
        </div>
      </div>
      <div *ngIf="admin.error" class="partner-card__admin-error">
        {{ admin.error }}
      </div>
      <div *ngIf="admin.partner" class="partner-card__admin-selected">
        <span class="partner-card__admin-selected-label"
          >Trenutno prikazujemo</span
        >
        <span class="partner-card__admin-selected-value">
          {{ admin.partner.naziv || admin.selection?.value }}
        </span>
      </div>
      <div *ngIf="!admin.partner" class="partner-card__admin-placeholder">
        Odaberite partnera da biste prikazali njegovu karticu.
      </div>
    </div>
  </div>

  <div *ngIf="summaryCards.length" class="partner-card__summary">
    <div
      class="partner-card__summary-card"
      *ngFor="let card of summaryCards; trackBy: trackBySummaryCard"
      [ngClass]="{
        'is-currency': card.isCurrency,
        'is-negative': card.isCurrency && (card.amount ?? 0) < 0
      }"
    >
      <span class="label">{{ card.label }}</span>
      <span
        class="value"
        [ngClass]="{ negative: card.isCurrency && (card.amount ?? 0) < 0 }"
      >
        {{ card.isCurrency ? (card.amount ?? 0 | rsdCurrency) : card.value }}
      </span>
    </div>
  </div>

  <div *ngIf="loading" class="partner-card__loading">
    <spinner></spinner>
  </div>

  <div *ngIf="!loading && errorMessage" class="partner-card__error">
    {{ errorMessage }}
  </div>

  <ng-container *ngIf="!loading && !errorMessage">
    <autom-divider *ngIf="!isAdmin || admin.partner"></autom-divider>
    <div
      *ngIf="groupViews.length; else partnerCardEmpty"
      class="partner-card__groups"
    >
      <section
        *ngFor="let groupView of groupViews; trackBy: trackByGroup"
        class="partner-card__group"
        [ngClass]="{
          'partner-card__group--novcana': isNovcanaGroup(groupView.data.tip)
        }"
      >
        <div class="partner-card__group-header">
          <div class="partner-card__group-title">
            <h3>{{ groupView.title }}</h3>
          </div>
        </div>

        <div class="partner-card__table-wrapper">
          <ng-container *ngIf="groupView.totalItems; else groupEmpty">
            <autom-table-flat
              [columns]="groupView.columns"
              [displayedColumns]="groupView.displayedColumns"
              [dataSource]="groupView.dataSource"
              [pagination]="{
                length: groupView.totalItems,
                pageIndex: groupView.pageIndex,
                pageSize: groupView.pageSize,
                pageSizeOptions: groupView.pageSizeOptions
              }"
              (pageChange)="onGroupPageChange(groupView, $event)"
            ></autom-table-flat>
          </ng-container>
          <ng-template #groupEmpty>
            <div class="partner-card__group-empty">
              Trenutno nema stavki za prikaz.
            </div>
          </ng-template>
        </div>
      </section>
    </div>
  </ng-container>

  <ng-template #partnerCardEmpty>
    <div class="partner-card__empty">
      {{
        isAdmin && !admin.partner
          ? "Pronađite i odaberite partnera kako biste videli karticu."
          : "Trenutno nema stavki za prikaz."
      }}
    </div>
  </ng-template>
</section>
